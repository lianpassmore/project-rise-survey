<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; -webkit-text-stroke: #000000; min-height: 14.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="en"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;title&gt;Trurivu - Kōrero with Lian&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.googleapis.com"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;400;500;600&amp;family=Playfair+Display:wght@400;500;600&amp;display=swap" rel="stylesheet"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>* {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-sizing: border-box;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>body {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Lexend Deca', system-ui, -apple-system, sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: linear-gradient(135deg, #f1eada, #fef3c7);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #3a2f26;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>line-height: 1.6;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>min-height: 100vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.container {<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>max-width: 1000px;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin: 0 auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.header {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-bottom: 30px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 30px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: linear-gradient(135deg, #f1eada, #cec1a8);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 16px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 8px 24px rgba(88, 71, 56, 0.15);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-left: 6px solid #b59e7d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.header h1 {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 2.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-weight: 600;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #584738;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-bottom: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.cultural-note {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: linear-gradient(135deg, #fef3c7, #f1eada);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-left: 4px solid #b59e7d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #584738;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#loading-section {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 40px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 16px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 8px 24px rgba(88, 71, 56, 0.1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-left: 6px solid #b59e7d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#loading-section h2 {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 1.8rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #584738;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#agent-section {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 30px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 16px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 8px 24px rgba(88, 71, 56, 0.1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-left: 6px solid #b59e7d;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>min-height: 70vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#agent-section h2 {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-family: 'Playfair Display', serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 1.6rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #584738;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.spinner {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border: 4px solid #f1eada;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-top: 4px solid #584738;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 50px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 50px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>animation: spin 1s linear infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin: 30px auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>@keyframes spin {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>0% { transform: rotate(0deg); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>100% { transform: rotate(360deg); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.session-info {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>background: linear-gradient(135deg, #fef3c7, #f1eada);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 15px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 0.9rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>color: #584738;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>elevenlabs-convai {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>display: block;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>min-height: 500px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="container"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="header"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h1&gt;Trurivu - Kōrero&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="cultural-note"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>Now for our conversation with Lian's Digital Voice</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="loading-section"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h2&gt;Ngā mihi nui! Preparing your kōrero...&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="spinner"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p&gt;Session connected. Loading Lian's Digital Voice...&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="agent-section" style="display: none;"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h2&gt;Kōrero with Lian&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="session-info"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;strong&gt;Session Connected:&lt;/strong&gt; Your demographic data has been linked to this conversation.<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>You can pause, take breaks, or end the conversation at any time.<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>This follows kaupapa Māori principles - your mana and cultural safety come first.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;br&gt;&lt;small&gt;Session ID: &lt;span id="session-display"&gt;&lt;/span&gt;&lt;/small&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;elevenlabs-convai<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>agent-id="agent_6301k3m6e0are30s5w4wbkx0zzxv"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>id="convai-widget"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/elevenlabs-convai&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let currentSessionId = null;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Extract session ID from URL</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const urlParams = new URLSearchParams(window.location.search);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const sessionId = urlParams.get('session');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (sessionId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>currentSessionId = sessionId;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('session-display').textContent = sessionId.substring(0, 20) + '...';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Store session ID globally for agent access</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>window.projectRiseSessionId = sessionId;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Initialize conversation logging</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>initializeConversationLogging();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Show agent after brief loading</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>document.getElementById('loading-section').style.display = 'none';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>document.getElementById('agent-section').style.display = 'block';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Configure ElevenLabs with session context</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>configureElevenLabsWithSession();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}, 3000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// No session - redirect back to form</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>window.location.href = 'index.html';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Function to log conversations to Supabase</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>async function logConversation(conversationData) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!currentSessionId) return;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>await fetch('/api/log-conversation', {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>headers: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>'Content-Type': 'application/json',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>body: JSON.stringify({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>session_id: currentSessionId,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>conversation_data: conversationData,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>timestamp: new Date().toISOString()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>console.error('Error logging conversation:', error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Initialize conversation logging with ElevenLabs events</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function initializeConversationLogging() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Listen for ElevenLabs widget events</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>window.addEventListener('message', function(event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (event.origin !== 'https://elevenlabs.com' &amp;&amp;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>event.origin !== 'https://widget.elevenlabs.com') return;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const { type, data } = event.data;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>switch (type) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>case 'convai:agent_response':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>logConversation({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>type: 'agent_response',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>content: data.text || data.message,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>timestamp: new Date().toISOString(),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>agent_id: 'agent_6301k3m6e0are30s5w4wbkx0zzxv'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>break;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>case 'convai:user_speech':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>logConversation({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>type: 'user_speech',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>content: data.transcript || data.text,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>timestamp: new Date().toISOString()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>break;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>case 'convai:conversation_started':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>logConversation({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>type: 'conversation_started',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>session_id: currentSessionId,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>timestamp: new Date().toISOString(),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>agent_id: 'agent_6301k3m6e0are30s5w4wbkx0zzxv'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>break;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>case 'convai:conversation_ended':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>logConversation({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>type: 'conversation_ended',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>session_id: currentSessionId,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>timestamp: new Date().toISOString()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Configure ElevenLabs with session context</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>function configureElevenLabsWithSession() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const widget = document.getElementById('convai-widget');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Try to pass session context to ElevenLabs</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (widget &amp;&amp; currentSessionId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>// Set custom attributes that ElevenLabs might pick up</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>widget.setAttribute('data-session-id', currentSessionId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>widget.setAttribute('data-user-context', JSON.stringify({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>session_id: currentSessionId,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>project: 'trurivu',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>cultural_context: 'kaupapa_maori'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Log page load</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (currentSessionId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>logConversation({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>type: 'page_loaded',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>page: 'interview.html',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>session_id: currentSessionId,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>timestamp: new Date().toISOString()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
